<?xml version="1.0" encoding="UTF-8"?>

<project name="iweb2" default="dist" basedir=".">

<!-- set global properties for this build -->
<property name="project.Name" value="Algorithms of the Intelligent Web"/>
<property name="iweb2.root" location=".."/>
<property name="iweb2.build.dir" value="${iweb2.root}/build"/>
<property name="iweb2.src" value="${iweb2.root}/src"/>
<property name="iweb2.classes" value="${iweb2.build.dir}/bytecode"/>
<property name="iweb2.lib" value="${iweb2.root}/lib"/>
<property name="iweb2.distro" value="${iweb2.build.dir}/dist"/>
<property name="iweb2.deploy" value="${iweb2.root}/deploy"/>
<property name="iweb2.deploy.lib" value="${iweb2.deploy}/lib"/>
<property name="log.dir" value="${iweb2.root}/log"/>
<property name="data.dir" value="${iweb2.root}/data"/>
<property name="temp.dir" value="${iweb2.root}/temp"/>
<property name="tools.dir" value="${iweb2.root}/tools"/>

<property environment="env"/>

<!-- list of all jars that are currently used in iweb2 app -->
<patternset id="thirdparty.jars">
  <include name="commons-codec-1.3.jar"/>
  <include name="commons-httpclient-3.1.jar"/>
  <include name="commons-lang-2.3.jar"/>
  <include name="commons-logging-1.1.1.jar"/>
  <include name="f2jutil.jar"/>
  <include name="jfreechart.jar"/>
  <include name="jigg-0.1.jar"/>
  <include name="rooster.jar"/>
  <include name="log4j.jar"/>
  <include name="lucene-analyzers-2.3.0.jar"/>
  <include name="lucene-core-2.3.0.jar"/>
  <include name="lucene-demos-2.3.0.jar"/>
  <include name="lucene-memory-2.3.0.jar"/>
  <include name="nekohtml.jar"/>
  <include name="poi-3.0.2-FINAL-20080204.jar"/>
  <include name="resolver.jar"/>
  <include name="secondstring-20070327.jar"/>
  <include name="serializer.jar"/>
  <include name="tm-extractors-1.0.jar"/>
  <include name="SuperCSV-1.16.jar"/>
  <include name="xercesImpl.jar"/>
  <include name="xml-apis.jar"/>
  <include name="jgraph.jar"/>
  <include name="bsh-2.0b4.jar"/>
  <!-- for Drools -->
  <include name="drools-compiler-4.0.4.jar"/>
  <include name="drools-core-4.0.4.jar"/>
  <include name="antlr-runtime-3.0.jar"/>
  <include name="janino-2.5.10.jar"/>
  <include name="mvel14-1.2.21.jar"/>
</patternset>

<!-- Compilation Classpath -->
<path id="compile.classpath">
  <fileset dir="${iweb2.lib}">
    <patternset refid="thirdparty.jars"/>
  </fileset>
</path>




<target name="init">
  <!-- Create the time stamp -->
  <tstamp>
    <format property="year" pattern="yyyy" />
  </tstamp>
  <!-- Create the build directory structure used by compile -->
  <mkdir dir="${iweb2.classes}"/>
  <mkdir dir="${temp.dir}"/>
  <mkdir dir="${log.dir}"/>
 <echo message="------------------- ${project.Name} ----------------------"/>
 <echo message=""/>

 <echo message="PATH = ${env.PATH}"/>
 <echo message="CLASSPATH = ${env.CLASSPATH}"/>
 <echo message="java.home = ${env.JAVA_HOME}"/>
 <echo message="ant.home = ${env.ANT_HOME}"/>
 <echo message="------------------------------------------------------"/>
 <echo message=""/>
 <echo message="root: ${iweb2.root}"/>
 <echo message="build: ${iweb2.build.dir}"/>
 <echo message="deploy: ${iweb2.deploy}"/>
 
</target>



 <!-- Build everything from scratch.  -->
  <target name="all" depends="dist">
    <echo message="All the source code has been compiled and the javadocs were created." />
  </target>

<!-- Compile the java code into bytecode -->
<target name="compile" depends="init">
  <javac srcdir="${iweb2.src}"
         destdir="${iweb2.classes}"
	 fork="true"
         debug="on"
         optimize="off"
         deprecation="on"
	 failonerror="true">
     <classpath refid="compile.classpath"/>
  </javac>
</target>


	<!-- Default target -->
<target name="dist" depends="compile">

  <mkdir dir="${iweb2.distro}"/>


  <!-- Put everything in ${iweb2.classes} into the JAR file -->
  <jar jarfile="${iweb2.distro}/iweb2.jar" basedir="${iweb2.classes}" update="true">
    <manifest>
      
      <section name="common">
        <attribute name="Implementation-Title" value="Iweb2"/>
        <attribute name="Implementation-Version" value="1.0.0.0 ${TODAY}"/> 
        <attribute name="Implementation-Vendor" value="Iweb2, Inc."/>
      </section>
    </manifest>
  </jar>

  <copy file="${iweb2.distro}/iweb2.jar" todir="${iweb2.deploy.lib}" />
  <copy todir="${iweb2.deploy.lib}">
    <fileset dir="${iweb2.lib}">
      <patternset refid="thirdparty.jars"/>
    </fileset>
  </copy>

  <echo message="The iweb2.jar has been created and placed in ${iweb2.deploy.lib}" />

</target>

 <!--
       ===================================================================
         Cleans up build and distribution directories
       ===================================================================
  -->
<target name="clean"
          description="--> cleans up iweb2.classes and dist directories, if any.">
  <delete dir="${iweb2.classes}"/>
  <delete dir="${iweb2.distro}" />
  <delete file="${iweb2.deploy.lib}/iweb2.jar"/>
  <delete>
    <fileset dir="${iweb2.deploy.lib}">
      <patternset refid="thirdparty.jars"/>
      <exclude name="bsh-2.0b4.jar"/>
    </fileset>
  </delete>
</target>

</project>

